import{E as M,i as S,d as T,c as F,m as P,s as D,a as L,b as z,e as j,g as A,f as H,h as J,r as c,u as N,R as O,j as U,k as I,l as B,n as R}from"./components-ugrZxUQv.js";import{a as h,g as y,H as W}from"./util-CkF2XvZm.js";import{l as t,g as p,s as q,d as V}from"./sessions-etKJw0ug.js";import{s as G,m as g}from"./util-B9sxEhC4.js";const k=async({interval:r,job:s,timeout:o})=>{const i=async()=>{try{const e=new Promise((u,a)=>setTimeout(()=>a(new Error("Timeout reached!")),o));await Promise.race([s,e])}catch(e){t.error("Error running background jobs:",e)}};await G(0),await i(),setInterval(async()=>{await i()},r)},E=async()=>{t.info("Starting refreshTokenJob...");const r=p("access"),s=p("refresh");if(!r||!s){t.warn("Refresh or access token missing. Access:",!!r,"Refresh:",!!s);return}const o=new Headers;o.append("x-cur-access",r),o.append("x-cur-refresh",s);try{t.info("Checking if refresh token is active..."),await h.isActive({type:"refresh"},{headers:{"x-cur-access":r,"x-cur-refresh":s}}),t.info("Refresh token is active. Requesting new access token...");const e=(await h.newAccessToken({headers:{"x-cur-access":r,"x-cur-refresh":s}})).data.accessToken;e?(t.info("New access token received. Updating secure cookie..."),q("access",e)):t.warn("No access token returned in response.")}catch(i){t.error("Error occurred during refreshTokenJob:",i);const e=await y(i);e?t.info("ERR_RES",JSON.stringify(e)):t.info("ERR_RES FOUND NULLLLL"),e!=null&&e.isStatus(W.Unauthorized)?(t.warn("Unauthorized (401) error. Deleting all cookies..."),V()):t.error("Unexpected error response:",e)}},K=async()=>{t.info("Starting accessTokenJob...");const r=p("access");if(!r){t.warn("Access token missing.");return}try{t.info("Checking if access token is active..."),await h.isActive({type:"access"},{headers:{"x-cur-access":r}}),t.info("Access token is active.")}catch(s){t.error("Error occurred during accessTokenJob:",s);const o=await y(s);o&&o.status===401?(t.warn("Unauthorized (401) error. Calling refreshTokenJob..."),await E()):t.error("Unexpected error response:",o)}};/**
 * @remix-run/react v2.15.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Q(r){if(!r)return null;let s=Object.entries(r),o={};for(let[i,e]of s)if(e&&e.__type==="RouteErrorResponse")o[i]=new M(e.status,e.statusText,e.data,e.internal===!0);else if(e&&e.__type==="Error"){if(e.__subType){let u=window[e.__subType];if(typeof u=="function")try{let a=new u(e.message);a.stack=e.stack,o[i]=a}catch{}}if(o[i]==null){let u=new Error(e.message);u.stack=e.stack,o[i]=u}}else o[i]=e;return o}/**
 * @remix-run/react v2.15.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */let d,n,x=!1,v;new Promise(r=>{v=r}).catch(()=>{});function X(r){if(!n){if(window.__remixContext.future.v3_singleFetch){if(!d){let l=window.__remixContext.stream;S(l,"No stream found for single fetch decoding"),window.__remixContext.stream=void 0,d=T(l,window).then(w=>{window.__remixContext.state=w.value,d.value=!0}).catch(w=>{d.error=w})}if(d.error)throw d.error;if(!d.value)throw d}let u=F(window.__remixManifest.routes,window.__remixRouteModules,window.__remixContext.state,window.__remixContext.future,window.__remixContext.isSpaMode),a;if(!window.__remixContext.isSpaMode){a={...window.__remixContext.state,loaderData:{...window.__remixContext.state.loaderData}};let l=P(u,window.location,window.__remixContext.basename);if(l)for(let w of l){let _=w.route.id,f=window.__remixRouteModules[_],m=window.__remixManifest.routes[_];f&&D(m,f,window.__remixContext.isSpaMode)&&(f.HydrateFallback||!m.hasLoader)?a.loaderData[_]=void 0:m&&!m.hasLoader&&(a.loaderData[_]=null)}a&&a.errors&&(a.errors=Q(a.errors))}n=L({routes:u,history:z(),basename:window.__remixContext.basename,future:{v7_normalizeFormMethod:!0,v7_fetcherPersist:window.__remixContext.future.v3_fetcherPersist,v7_partialHydration:!0,v7_prependBasename:!0,v7_relativeSplatPath:window.__remixContext.future.v3_relativeSplatPath,v7_skipActionErrorRevalidation:window.__remixContext.future.v3_singleFetch===!0},hydrationData:a,mapRouteProperties:j,dataStrategy:window.__remixContext.future.v3_singleFetch?A(window.__remixManifest,window.__remixRouteModules,()=>n):void 0,patchRoutesOnNavigation:H(window.__remixManifest,window.__remixRouteModules,window.__remixContext.future,window.__remixContext.isSpaMode,window.__remixContext.basename)}),n.state.initialized&&(x=!0,n.initialize()),n.createRoutesForHMR=J,window.__remixRouter=n,v&&v(n)}let[s,o]=c.useState(void 0),[i,e]=c.useState(n.state.location);return c.useLayoutEffect(()=>{x||(x=!0,n.initialize())},[]),c.useLayoutEffect(()=>n.subscribe(u=>{u.location!==i&&e(u.location)}),[i]),N(n,window.__remixManifest,window.__remixRouteModules,window.__remixContext.future,window.__remixContext.isSpaMode),c.createElement(c.Fragment,null,c.createElement(O.Provider,{value:{manifest:window.__remixManifest,routeModules:window.__remixRouteModules,future:window.__remixContext.future,criticalCss:s,isSpaMode:window.__remixContext.isSpaMode}},c.createElement(U,{location:i},c.createElement(I,{router:n,fallbackElement:null,future:{v7_startTransition:!0}}))),window.__remixContext.future.v3_singleFetch?c.createElement(c.Fragment,null):null)}var b,C=B;C.createRoot,b=C.hydrateRoot;c.startTransition(()=>{b(document,R.jsx(c.StrictMode,{children:R.jsx(X,{})})),k({interval:g.seconds(15),timeout:5e3,job:()=>K()}),k({interval:g.minutes(5),timeout:5e3,job:()=>E()})});
