import{n as e,F as y,w as b,y as v,r as f,A as w}from"./components-BK_sQQer.js";import{z as u,p as g,g as d,a as N,l as x,s as h,e as S}from"./sessions-B53D3irw.js";import{A as C}from"./async-img-BS3wYUo9.js";import{F as k,u as T}from"./hooks-o0jWI174.js";import{B as O}from"./button-DTEMKkxa.js";import{a as I,b as E,c as V,d as A,C as F}from"./card-DYAAiYtJ.js";import{I as B}from"./input-BQeOwKAN.js";import{u as P}from"./use-session-DgBKkCMm.js";import{c as R}from"./util-B9sxEhC4.js";import"./createLucideIcon-BL_OdkR-.js";const p=u.object({code:u.string()}),Q=async({request:s})=>{var l;const o=await s.formData();try{const t=g(o,{schema:p}),r=(l=o.get("code"))==null?void 0:l.valueOf().toString(),i=d("email");if(!r||!i)return t.reply({formErrors:["Submission error"]});const{accessToken:n,refreshToken:c}=(await N.confirmOtp({email:i,code:r})).data;return!n||!c?t.reply({formErrors:["Submission error"]}):(x.info("new accessToken set:",n),x.info("new refreshToken set:",c),h("access",n),h("refresh",c,{expires:30}),t.reply())}catch(t){return S({formData:o,schema:p,error:t})}};function U(){const s=D();return e.jsx("div",{className:"min-h-[calc(100vh-136px)] flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-[1200px] grid md:grid-cols-2 gap-8 items-center",children:[e.jsx("div",{className:"w-full max-w-md mx-auto space-y-8",children:e.jsxs(I,{className:"w-full",children:[e.jsxs(E,{className:"space-y-1 text-center",children:[e.jsx(V,{className:"text-2xl",children:"OTP Verification"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Enter OTP we will send to useradmit@gmail.com"})]}),e.jsx(A,{children:e.jsxs(y,{method:"post",id:s.form.id,onSubmit:s.form.onSubmit,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center space-x-4",children:e.jsx(B,{name:s.fields.code.name,type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:7,style:{fontSize:"18px"},onChange:s.handleInputChange,className:"w-64 h-12 text-center font-semibold tracking-widest text-gray-600",value:s.otp})}),e.jsx("div",{className:"text-center",children:s.fields.code.errors&&e.jsx(k,{errors:s.fields.code.errors})}),e.jsx(O,{type:"submit",className:R("w-64 bg-purple-600 hover:bg-purple-700 mx-auto flex",{"opacity-50":s.isSubmitting}),disabled:s.isSubmitting,children:"Confirm"}),e.jsx("div",{className:"text-center",children:e.jsxs(b,{to:"/sign-in",className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),"Back to log in"]})})]})})]})}),e.jsx("div",{className:"hidden md:block relative h-full min-h-[600px] rounded-3xl overflow-hidden bg-gradient-to-br from-purple-500 to-purple-700",children:e.jsx(C,{src:"https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=800&h=1200&fit=crop",alt:"OTP Verification",className:"object-cover opacity-80 h-full w-full"})})]})})}const D=()=>{const s=v(),[o,l]=f.useState(""),t=w(),r=P(),i=(s==null?void 0:s.status)==="success",n=a=>{const m=a.target.value.replace(/[^0-9]/g,"");l(m)};if(f.useEffect(()=>{r.isSignedIn&&setTimeout(()=>t("/"),150)},[r.isSignedIn]),i){const a=d("access"),m=d("refresh");a&&m&&r.signIn(a)}const[c,j]=T({id:"otp-signin",onValidate({formData:a}){return g(a,{schema:p})},lastResult:s,shouldRevalidate:"onBlur"});return{action:s,otp:o,handleInputChange:n,form:c,fields:j,isSubmitting:i}};export{Q as clientAction,U as default};
